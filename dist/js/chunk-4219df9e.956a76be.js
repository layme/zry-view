(window['webpackJsonp'] = window['webpackJsonp'] || []).push([['chunk-4219df9e'], { '0efc': function (t, e, a) {}, '148b': function (t, e, a) { 'use strict'; var i = a('bf8d'), r = a.n(i); r.a }, '2fc9': function (t, e, a) { 'use strict'; var i = a('c4da'), r = a.n(i); r.a }, '411c': function (t, e, a) { 'use strict'; var i = a('0efc'), r = a.n(i); r.a }, bf8d: function (t, e, a) {}, c4da: function (t, e, a) {}, e404: function (t, e, a) { 'use strict'; a.r(e); var i = function () { var t = this, e = t.$createElement, a = t._self._c || e; return a('div', [a('marketing-activity-search-form', { on: { search: t.listActivity, create: t.createActivity } }), a('Table', { staticClass: 'my-table', attrs: { stripe: '', columns: t.columns, data: t.activityList, loading: t.loading }, scopedSlots: t._u([{ key: 'isOnline', fn: function (e) { var i = e.row; return [i.isOnline === 1 ? a('Tag', { attrs: { color: 'success' } }, [t._v('已上线')]) : a('Tag', { attrs: { color: 'default' } }, [t._v('已下线')])] } }, { key: 'action', fn: function (e) { var i = e.row; return [a('a', { staticClass: 'my-btn', on: { click: function (e) { t.changeIsOnline(i) } } }, [t._v(t._s(i.isOnline === 1 ? '下线' : '上线'))]), a('a', { staticClass: 'my-btn', on: { click: function (e) { t.updateActivity(i) } } }, [t._v('修改')]), a('a', { staticStyle: { color: '#ed4014' }, on: { click: function (e) { t.confirmRemove(i) } } }, [t._v('删除')])] } }]) }), a('Page', { staticClass: 'my-page', attrs: { total: t.total, 'show-total': '', current: t.paramDto.pageNum, 'page-size': t.paramDto.pageSize }, on: { 'update:current': function (e) { t.$set(t.paramDto, 'pageNum', e) }, 'on-change': t.handlePageChange } }), a('Modal', { attrs: { title: t.title, loading: t.modalLoading, width: '500' }, on: { 'on-ok': t.saveActivity }, model: { value: t.visible, callback: function (e) { t.visible = e }, expression: 'visible' } }, [t.visible ? a('marketing-activity-form', { ref: 'activityForm', attrs: { activity: t.row }, on: { submit: t.handleSubmit, error: t.handleError } }) : t._e()], 1)], 1) }, r = [], s = (a('f751'), function () { var t = this, e = t.$createElement, a = t._self._c || e; return a('Form', { attrs: { model: t.paramDto, 'label-width': 70 } }, [a('Row', { attrs: { gutter: 20 } }, [a('Col', { attrs: { span: '8' } }, [a('FormItem', { attrs: { label: '活动项目' } }, [a('Select', { attrs: { placeholder: '', clearable: '' }, model: { value: t.paramDto.projectBid, callback: function (e) { t.$set(t.paramDto, 'projectBid', e) }, expression: 'paramDto.projectBid' } }, t._l(t.$store.state.user.projectList, function (t) { return a('Option', { key: t.bid, attrs: { label: t.projectName, value: t.bid } }) }))], 1)], 1), a('Col', { attrs: { span: '8' } }, [a('FormItem', { attrs: { label: '活动标题' } }, [a('Input', { attrs: { placeholder: '', clearable: '' }, model: { value: t.paramDto.title, callback: function (e) { t.$set(t.paramDto, 'title', typeof e === 'string' ? e.trim() : e) }, expression: 'paramDto.title' } })], 1)], 1), a('Col', { attrs: { span: '8' } }, [a('FormItem', { attrs: { label: '活动状态' } }, [a('Select', { attrs: { placeholder: '', clearable: '' }, model: { value: t.paramDto.isOnline, callback: function (e) { t.$set(t.paramDto, 'isOnline', e) }, expression: 'paramDto.isOnline' } }, t._l(t.statusOptions, function (t) { return a('Option', { key: t.value, attrs: { label: t.label, value: t.value } }) }))], 1)], 1)], 1), a('Row', { attrs: { gutter: 20 } }, [a('Col', { attrs: { span: '12' } }, [a('Button', { attrs: { type: 'primary', icon: 'ios-search' }, on: { click: t.submit } }, [t._v(' 查 询')])], 1), a('Col', { staticStyle: { 'text-align': 'right' }, attrs: { span: '12' } }, [a('Button', { attrs: { type: 'primary', icon: '' }, on: { click: t.create } }, [t._v(' 新 增')])], 1)], 1)], 1) }), n = [], o = { name: 'marketingActivitySearchForm', data: function () { return { paramDto: { projectBid: '', title: '', isOnline: '' }, statusOptions: [{ label: '已上线', value: 1 }, { label: '已下线', value: 0 }] } }, methods: { submit: function () { this.$emit('search', this.paramDto) }, create: function () { this.$emit('create') } } }, l = o, c = (a('411c'), a('2877')), u = Object(c['a'])(l, s, n, !1, null, '352f9a42', null); u.options.__file = 'marketingActivitySearchForm.vue'; var p = u.exports, m = function () { var t = this, e = t.$createElement, a = t._self._c || e; return a('Form', { ref: 'activityForm', attrs: { model: t.paramDto, rules: t.activityRules, 'label-width': 75 } }, [a('FormItem', { attrs: { label: '活动项目', prop: 'projectBid' } }, [a('Select', { attrs: { placeholder: '' }, model: { value: t.paramDto.projectBid, callback: function (e) { t.$set(t.paramDto, 'projectBid', e) }, expression: 'paramDto.projectBid' } }, t._l(t.$store.state.user.projectList, function (t) { return a('Option', { key: t.bid, attrs: { label: t.projectName, value: t.bid } }) }))], 1), a('FormItem', { attrs: { label: '活动标题', prop: 'title' } }, [a('Input', { attrs: { placeholder: '', clearable: '' }, model: { value: t.paramDto.title, callback: function (e) { t.$set(t.paramDto, 'title', typeof e === 'string' ? e.trim() : e) }, expression: 'paramDto.title' } })], 1), a('FormItem', { attrs: { label: '副标题', prop: 'subTitle' } }, [a('Input', { attrs: { placeholder: '', clearable: '' }, model: { value: t.paramDto.subTitle, callback: function (e) { t.$set(t.paramDto, 'subTitle', typeof e === 'string' ? e.trim() : e) }, expression: 'paramDto.subTitle' } })], 1), a('FormItem', { attrs: { label: '活动日期', prop: 'dateRange' } }, [a('DatePicker', { staticClass: 'my-date-picker', attrs: { type: 'daterange', 'split-panels': '', placeholder: '', editable: !1 }, model: { value: t.dateRange, callback: function (e) { t.dateRange = e }, expression: 'dateRange' } })], 1), a('FormItem', { attrs: { label: '活动链接', prop: 'jumpLink' } }, [a('Input', { attrs: { placeholder: '', clearable: '' }, model: { value: t.paramDto.jumpLink, callback: function (e) { t.$set(t.paramDto, 'jumpLink', typeof e === 'string' ? e.trim() : e) }, expression: 'paramDto.jumpLink' } })], 1), a('Row', { attrs: { gutter: 20 } }, [a('Col', { attrs: { span: 12 } }, [a('FormItem', { attrs: { label: '显示顺序', prop: 'imgIndex' } }, [a('Input', { attrs: { placeholder: '', clearable: '' }, model: { value: t.paramDto.imgIndex, callback: function (e) { t.$set(t.paramDto, 'imgIndex', typeof e === 'string' ? e.trim() : e) }, expression: 'paramDto.imgIndex' } })], 1)], 1), a('Col', { attrs: { span: 12 } }, [a('FormItem', { attrs: { label: '是否跳转', prop: 'isJump' } }, [a('RadioGroup', { model: { value: t.paramDto.isJump, callback: function (e) { t.$set(t.paramDto, 'isJump', e) }, expression: 'paramDto.isJump' } }, [a('Radio', { attrs: { label: 1 } }, [t._v('是')]), a('Radio', { attrs: { label: 0 } }, [t._v('否')])], 1)], 1)], 1)], 1), a('FormItem', { attrs: { label: '活动图片', prop: 'imgUrl' } }, [a('Input', { directives: [{ name: 'show', rawName: 'v-show', value: !1, expression: 'false' }], attrs: { placeholder: '', clearable: '' }, model: { value: t.paramDto.imgUrl, callback: function (e) { t.$set(t.paramDto, 'imgUrl', e) }, expression: 'paramDto.imgUrl' } }), t._l(t.uploadList, function (e, i) { return a('div', { key: i, staticClass: 'demo-upload-list' }, [e.status === 'finished' ? [a('img', { attrs: { src: e.response ? e.response.body.attachmentImgUrl : e.url } }), a('div', { staticClass: 'demo-upload-list-cover' }, [a('Icon', { attrs: { type: 'ios-trash-outline' }, nativeOn: { click: function (a) { t.handleRemove(e) } } })], 1)] : [e.showProgress ? a('Progress', { attrs: { percent: e.percentage, 'hide-info': '' } }) : t._e()]], 2) }), t.uploadList.length ? t._e() : a('Upload', { ref: 'upload', staticStyle: { display: 'inline-block', width: '46px' }, attrs: { accept: 'image/*', type: 'drag', headers: { Authorization: t.$store.state.user.token }, action: t.uploadPicUrl, 'show-upload-list': !1, 'on-success': t.handleSuccess, 'on-error': t.handleError, 'max-size': 200, 'on-exceeded-size': t.handleMaxSize } }, [a('div', { staticStyle: { width: '46px', 'line-height': '46px' } }, [a('Icon', { attrs: { type: 'ios-camera', size: '20' } })], 1)]), t.uploadList.length ? t._e() : a('div', [t._v('图片大小不能超过 200KB')])], 2)], 1) }, d = [], h = (a('6b54'), a('ac6a'), a('456d'), a('90de')), g = { name: 'marketingActivityForm', props: { activity: Object }, data: function () { return { paramDto: { bid: '', projectBid: '', title: '', subTitle: '', startDate: '', endDate: '', jumpLink: '', imgIndex: '', isJump: '', imgUrl: '' }, dateRange: [], uploadPicUrl: this.$store.state.app.baseUrl + '/system/upLoadImg.action', uploadList: [], activityRules: { projectBid: [{ required: !0, message: '请选择项目', trigger: 'change' }], title: [{ required: !0, type: 'string', message: '请输入标题', trigger: 'blur' }], subTitle: [{ required: !0, type: 'string', message: '请输入副标题', trigger: 'blur' }], dateRange: [{ required: !0, type: 'array', fields: { 0: { type: 'date', required: !0, message: '请选择活动日期' }, 1: { type: 'date', required: !0, message: '请选择活动日期' } }, trigger: 'change' }], jumpLink: [{ required: !0, type: 'string', message: '请输入活动链接', trigger: 'blur' }], imgIndex: [{ required: !0, type: 'string', message: '请输入显示顺序', trigger: 'blur' }], isJump: [{ required: !0, type: 'number', message: '请选择是否跳转', trigger: 'change' }], imgUrl: [{ required: !0, message: '请上传活动图片', trigger: 'blur' }] } } }, methods: { validForm: function () { var t = this; this.$refs['activityForm'].validate(function (e) { e ? t.$emit('submit', t.paramDto) : t.$emit('error') }) }, handleMaxSize: function (t) { this.$Message.warning('文件大小超过了限制') }, handleSuccess: function (t, e, a) { t.code !== 200 ? this.$Message.error(t.message) : (this.paramDto.imgUrl = t.body.attachmentImgUrl, this.uploadList = this.$refs.upload.fileList) }, handleError: function (t, e, a) { this.$Message.error('图片上传失败'), console.info(t) }, handleRemove: function (t) { if (this.$refs.upload) { var e = this.$refs.upload.fileList; this.$refs.upload.fileList.splice(e.indexOf(t), 1) } else this.uploadList.splice(0, 1); this.paramDto.imgUrl = '' } }, watch: { dateRange: function (t) { this.paramDto.startDate = t[0] ? Object(h['d'])(t[0], 'date') : '', this.paramDto.endDate = t[1] ? Object(h['d'])(t[1], 'date') : '' } }, created: function () { Object.keys(this.activity).length && (this.paramDto.bid = this.activity.bid, this.paramDto.projectBid = this.activity.projectBid, this.paramDto.title = this.activity.title, this.paramDto.subTitle = this.activity.subTitle, this.dateRange.push(this.activity.startDate), this.dateRange.push(this.activity.endDate), this.paramDto.jumpLink = this.activity.jumpLink, this.paramDto.imgIndex = this.activity.imgIndex.toString(), this.paramDto.isJump = this.activity.isJump, this.paramDto.imgUrl = this.activity.imgUrl, this.uploadList.push({ url: this.paramDto.imgUrl, status: 'finished' })) } }, v = g, f = (a('2fc9'), Object(c['a'])(v, m, d, !1, null, '5bfe9f5c', null)); f.options.__file = 'marketingActivityForm.vue'; var b = f.exports, y = (a('cadf'), a('551c'), a('097d'), a('6b6c')), k = function (t) { return y['a'].request({ url: '/marketingActivity/getMarketingActivities.action', method: 'post', data: t }) }, D = function (t) { return y['a'].request({ method: 'post', url: '/marketingActivity/changeIsOnline.action', data: t }) }, $ = function (t) { return y['a'].request({ method: 'post', url: '/marketingActivity/del.action', params: t }) }, j = function (t) { return y['a'].request({ method: 'post', url: '/marketingActivity/addMarketingActivity.action', data: t }) }, x = function (t) { return y['a'].request({ method: 'post', url: '/marketingActivity/updateMarketingActivity.action', data: t }) }, I = { name: 'marketingActivityList', components: { marketingActivitySearchForm: p, marketingActivityForm: b }, data: function () { return { paramDto: { pageNum: 1, pageSize: 10 }, statusOptions: [{ label: '已上线', value: 1 }, { label: '已下线', value: 0 }], loading: !1, activityList: [], total: 0, columns: [{ title: '项目名称', key: 'projectName' }, { title: '标题', key: 'title' }, { title: '副标题', key: 'subTitle' }, { title: '开始日期', key: 'startDate' }, { title: '结束日期', key: 'endDate' }, { title: '活动链接', key: 'jumpLink' }, { title: '状态', slot: 'isOnline' }, { title: '操作', slot: 'action', width: 130 }], visible: !1, title: '', modalLoading: !0, row: {} } }, methods: { listActivity: function (t) { Object.assign(this.paramDto, t), this.paramDto.pageNum = 1, this.handlePageChange() }, handlePageChange: function () { var t = this; this.loading = !0, k(this.paramDto).then(function (e) { t.activityList = e.body.rows, t.total = e.body.total, t.loading = !1 }).catch(function () { t.loading = !1 }) }, changeIsOnline: function (t) { var e = this, a = 0, i = ''; t.onLine === 1 ? (a = 0, i = '确定要下线吗？') : (a = 1, i = '确定要上线吗？'), this.$Modal.confirm({ title: '通知', content: '<p>' + i + '</p>', onOk: function () { var i = { bid: t.bid, isOnline: a }; D(i).then(function (t) { e.$Message.success('操作成功'), e.handlePageChange() }) }, onCancel: function () {} }) }, createActivity: function () { this.title = '新增营销活动', this.visible = !0, this.row = {} }, updateActivity: function (t) { this.title = '修改营销活动', this.visible = !0, this.row = t }, saveActivity: function () { this.$refs.activityForm.validForm() }, handleSubmit: function (t) { t.bid ? this.handleUpdateActivity(t) : this.handleSaveActivity(t) }, handleUpdateActivity: function (t) { var e = this; x(t).then(function (t) { e.$Message.success('更新营销活动成功'), e.visible = !1, e.listActivity() }).catch(function () { e.handleError() }) }, handleSaveActivity: function (t) { var e = this; j(t).then(function (t) { e.$Message.success('创建营销活动成功'), e.visible = !1, e.listActivity() }).catch(function () { e.handleError() }) }, handleError: function () { var t = this; setTimeout(function () { t.modalLoading = !1, t.$nextTick(function () { t.modalLoading = !0 }) }, 500) }, confirmRemove: function (t) { var e = this; this.$Modal.confirm({ title: '通知', content: '<p>确定删除该营销活动吗？</p>', onOk: function () { $({ bid: t.bid }).then(function (t) { e.$Message.success('删除成功'), e.handlePageChange() }) }, onCancel: function () {} }) } }, created: function () { this.handlePageChange() } }, L = I, _ = (a('148b'), Object(c['a'])(L, i, r, !1, null, '41090a71', null)); _.options.__file = 'marketingActivityList.vue'; e['default'] = _.exports } }])
