(window['webpackJsonp'] = window['webpackJsonp'] || []).push([['chunk-cdbe8056'], { '12a6': function (t, e, a) { 'use strict'; var o = a('2ce4'), n = a.n(o); n.a }, 2934: function (t, e, a) { 'use strict'; a.d(e, 'b', function () { return n }), a.d(e, 'a', function () { return r }), a.d(e, 'd', function () { return i }), a.d(e, 'c', function () { return c }); var o = a('6b6c'), n = function () { return o['a'].request({ url: '/project/getCity.action', method: 'get' }) }, r = function (t) { return o['a'].request({ url: '/project/getAreaByCity.action', method: 'get', params: { cityCode: t } }) }, i = function (t) { return o['a'].request({ url: '/system/requestExportFile.action', method: 'post', data: t }) }, c = function (t) { return o['a'].request({ url: '/system/getExportProcess', method: 'get', params: { key: t } }) } }, '2ce4': function (t, e, a) {}, '3b96': function (t, e, a) { 'use strict'; var o = a('a719'), n = a.n(o); n.a }, '43e9': function (t, e, a) { 'use strict'; var o = a('5876'), n = a.n(o); n.a }, '489f': function (t, e, a) { 'use strict'; a.r(e); var o = function () { var t = this, e = t.$createElement, a = t._self._c || e; return a('div', [a('coupon-form', { attrs: { 'batch-number': t.$route.query.batchNumber, 'activity-number': t.$route.query.activityNumber }, on: { search: t.listCoupon, export: t.exportData } }), a('Table', { staticClass: 'my-table', attrs: { stripe: '', columns: t.columns, data: t.couponList, loading: t.loading }, scopedSlots: t._u([{ key: 'ticketNumber', fn: function (e) { var o = e.row; return [a('a', { on: { click: function (e) { t.openCouponDetail(o) } } }, [t._v(t._s(o.ticketNumber))])] } }, { key: 'activityNumber', fn: function (e) { var o = e.row; return [a('a', { on: { click: function (e) { t.toActivityDetail(o) } } }, [t._v(t._s(o.activityNumber))])] } }, { key: 'customerPhone', fn: function (e) { var o = e.row; return [o.customerPhone ? a('div', [t._v('开启')]) : a('div', [t._v('-')])] } }, { key: 'orderNumber', fn: function (e) { var o = e.row; return [o.orderNumber ? a('div', [t._v('开启')]) : a('div', [t._v('-')])] } }]) }), a('Page', { staticClass: 'my-page', attrs: { total: t.total, 'show-total': '', current: t.paramDto.page, 'page-size': t.paramDto.size }, on: { 'update:current': function (e) { t.$set(t.paramDto, 'page', e) }, 'on-change': t.handlePageChange } }), a('Modal', { attrs: { title: '优惠券详情', width: '600', 'footer-hide': '' }, model: { value: t.couponVisible, callback: function (e) { t.couponVisible = e }, expression: 'couponVisible' } }, [a('div', { staticClass: 'full-top' }, [t.couponLoading ? a('Spin', { staticClass: 'full-spin', attrs: { size: 'large', fix: '' } }) : t._e(), Object.keys(t.coupon).length ? a('coupon-detail-form', { attrs: { coupon: t.coupon } }) : a('div', { staticClass: 'no-data' }, [t._v('暂无数据')])], 1)]), a('export-file', { ref: 'exportFile' })], 1) }, n = [], r = (a('f751'), function () { var t = this, e = t.$createElement, a = t._self._c || e; return a('Form', { attrs: { model: t.paramDto, 'label-width': 100 } }, [a('Row', { attrs: { gutter: 20 } }, [a('Col', { attrs: { span: '8' } }, [a('FormItem', { attrs: { label: '手机号' } }, [a('Input', { attrs: { placeholder: '', clearable: '' }, model: { value: t.paramDto.phone, callback: function (e) { t.$set(t.paramDto, 'phone', typeof e === 'string' ? e.trim() : e) }, expression: 'paramDto.phone' } })], 1)], 1), a('Col', { attrs: { span: '8' } }, [a('FormItem', { attrs: { label: '优惠券号' } }, [a('Input', { attrs: { placeholder: '', clearable: '' }, model: { value: t.paramDto.ticketNumber, callback: function (e) { t.$set(t.paramDto, 'ticketNumber', typeof e === 'string' ? e.trim() : e) }, expression: 'paramDto.ticketNumber' } })], 1)], 1), a('Col', { attrs: { span: '8' } }, [a('FormItem', { attrs: { label: '批次号' } }, [a('Input', { attrs: { placeholder: '', clearable: '' }, model: { value: t.paramDto.batchNumber, callback: function (e) { t.$set(t.paramDto, 'batchNumber', typeof e === 'string' ? e.trim() : e) }, expression: 'paramDto.batchNumber' } })], 1)], 1)], 1), a('Row', { attrs: { gutter: 20 } }, [a('Col', { attrs: { span: '8' } }, [a('FormItem', { attrs: { label: '活动项目' } }, [a('Select', { model: { value: t.paramDto.projectBid, callback: function (e) { t.$set(t.paramDto, 'projectBid', e) }, expression: 'paramDto.projectBid' } }, t._l(t.$store.state.user.projectList, function (t) { return a('Option', { key: t.bid, attrs: { label: t.projectName, value: t.bid } }) }))], 1)], 1), a('Col', { attrs: { span: '8' } }, [a('FormItem', { attrs: { label: '优惠活动编号' } }, [a('Input', { attrs: { placeholder: '', clearable: '' }, model: { value: t.paramDto.activityNumber, callback: function (e) { t.$set(t.paramDto, 'activityNumber', typeof e === 'string' ? e.trim() : e) }, expression: 'paramDto.activityNumber' } })], 1)], 1), a('Col', { attrs: { span: '8' } }, [a('FormItem', { attrs: { label: '优惠活动名称' } }, [a('Input', { attrs: { placeholder: '', clearable: '' }, model: { value: t.paramDto.activityName, callback: function (e) { t.$set(t.paramDto, 'activityName', typeof e === 'string' ? e.trim() : e) }, expression: 'paramDto.activityName' } })], 1)], 1)], 1), a('Row', { attrs: { gutter: 20 } }, [a('Col', { attrs: { span: '8' } }, [a('FormItem', { attrs: { label: '活动时间' } }, [a('DatePicker', { staticClass: 'my-date-picker', attrs: { type: 'daterange', 'split-panels': '', placeholder: '', editable: !1 }, model: { value: t.paramDto.dateRange, callback: function (e) { t.$set(t.paramDto, 'dateRange', e) }, expression: 'paramDto.dateRange' } })], 1)], 1), a('Col', { attrs: { span: '8' } }, [a('FormItem', { attrs: { label: '活动状态' } }, [a('CheckboxGroup', { model: { value: t.paramDto.activityState, callback: function (e) { t.$set(t.paramDto, 'activityState', e) }, expression: 'paramDto.activityState' } }, t._l(t.activityStatusOptions, function (e, o) { return a('Checkbox', { key: o, attrs: { label: e.value } }, [t._v('\n            ' + t._s(e.label) + '\n          ')]) }))], 1)], 1), a('Col', { attrs: { span: '8' } }, [a('FormItem', { attrs: { label: '优惠券状态' } }, [a('CheckboxGroup', { model: { value: t.paramDto.couponState, callback: function (e) { t.$set(t.paramDto, 'couponState', e) }, expression: 'paramDto.couponState' } }, t._l(t.couponStatusOptions, function (e, o) { return a('Checkbox', { key: o, attrs: { label: e.value } }, [t._v('\n            ' + t._s(e.label) + '\n          ')]) }))], 1)], 1)], 1), a('Row', { attrs: { gutter: 20 } }, [a('Col', { attrs: { span: '12' } }, [a('Button', { attrs: { type: 'primary', icon: 'ios-search' }, on: { click: t.submit } }, [t._v(' 查 询')])], 1), a('Col', { staticStyle: { 'text-align': 'right' }, attrs: { span: '12' } }, [a('Button', { attrs: { type: 'warning', icon: 'ios-cloud-download-outline' }, on: { click: t.exportData } }, [t._v('导出')])], 1)], 1)], 1) }), i = [], c = a('90de'), s = { name: 'couponForm', props: { batchNumber: String, activityNumber: String }, data: function () { return { paramDto: { phone: '', ticketNumber: '', batchNumber: this.batchNumber, projectBid: '', activityNumber: this.activityNumber, activityName: '', dateRange: [], startDate: '', endDate: '', activityState: [], couponState: [] }, activityStatusOptions: [{ label: '未开启', value: 0 }, { label: '进行中', value: 1 }, { label: '已关闭', value: 2 }, { label: '已结束', value: 3 }], couponStatusOptions: [{ label: '初始态', value: 0 }, { label: '可使用', value: 1 }, { label: '已使用', value: 2 }, { label: '已关闭', value: 3 }] } }, methods: { submit: function () { this.$emit('search', this.paramDto) }, exportData: function () { this.$emit('export', this.paramDto) } }, watch: { 'paramDto.dateRange': function (t) { this.paramDto.startDate = t[0] ? Object(c['d'])(t[0], 'date') : '', this.paramDto.endDate = t[1] ? Object(c['d'])(t[1], 'date') : '' }, batchNumber: function (t) { this.paramDto.batchNumber = t }, activityNumber: function (t) { this.paramDto.activityNumber = t } }, created: function () { this.submit() } }, l = s, u = (a('3b96'), a('2877')), p = Object(u['a'])(l, r, i, !1, null, '9ff0d17c', null); p.options.__file = 'couponForm.vue'; var m = p.exports, b = function () { var t = this, e = t.$createElement, a = t._self._c || e; return a('Form', { ref: 'ticketForm', attrs: { model: t.coupon, 'label-width': 80 } }, [a('Row', { attrs: { gutter: 20 } }, [a('Col', { attrs: { span: 12 } }, [a('FormItem', { attrs: { label: '优惠活动: ' } }, [a('span', [t._v(t._s(t.coupon.activityNumber))])])], 1), a('Col', { attrs: { span: 12 } }, [a('FormItem', { attrs: { label: '优惠券编号: ' } }, [a('span', [t._v(t._s(t.coupon.ticketNumber))])])], 1)], 1), a('Row', { attrs: { gutter: 20 } }, [a('Col', { attrs: { span: 12 } }, [a('FormItem', { attrs: { label: '优惠券状态: ' } }, [a('span', [t._v(t._s(t._f('couponStatusFilter')(t.coupon.status)))])])], 1), a('Col', { attrs: { span: 12 } }, [a('FormItem', { attrs: { label: '绑定账号: ' } }, [a('span', [t._v(t._s(t._f('nullFilter')(t.coupon.customerPhone)))])])], 1)], 1), a('Row', { attrs: { gutter: 20 } }, [a('Col', { attrs: { span: 12 } }, [a('FormItem', { attrs: { label: '兑换码: ' } }, [a('span', [t._v(t._s(t.coupon.redeemCode))])])], 1), a('Col', { attrs: { span: 12 } }, [a('FormItem', { attrs: { label: '优惠券金额: ' } }, [a('span', [t._v('¥ ' + t._s(t.coupon.ticketAmount))])])], 1)], 1), a('FormItem', { attrs: { label: '有效期: ' } }, [t.coupon.limitDate ? a('span', [t._v('绑定至账户的 ' + t._s(t.coupon.ticketAmount) + ' 天内')]) : a('span', [t._v(t._s(t.coupon.startDateShow) + ' 至 ' + t._s(t.coupon.endDateShow))])]), a('FormItem', { attrs: { label: '使用条件: ' } }, [t.coupon.limitMoney ? a('div', [t._v('消费满 ' + t._s(t.coupon.limitMoney) + ' 可使用')]) : t._e(), t.coupon.activityCondition ? a('div', [t._v(t._s(t.coupon.activityCondition))]) : t._e(), t.coupon.limitMoney || t.coupon.activityCondition ? t._e() : a('div', [t._v('无限制条件')])])], 1) }, d = [], v = { name: 'couponDetailForm', props: { coupon: Object }, data: function () { return {} }, filters: { couponStatusFilter: function (t) { switch (t) { case 0:return '初始态'; case 1:return '可使用'; case 2:return '已使用'; case 3:return '已关闭' } } } }, f = v, h = (a('bf30'), Object(u['a'])(f, b, d, !1, null, 'aab765c4', null)); h.options.__file = 'couponDetailForm.vue'; var y = h.exports, g = (a('cadf'), a('551c'), a('097d'), a('6b6c')), D = function (t) { return g['a'].request({ url: '/coupon/search.action', method: 'post', data: t }) }, _ = function (t) { return g['a'].request({ url: '/coupon/getTicketDetail', method: 'get', params: { ticketBid: t } }) }, k = a('ef05'), x = { name: 'couponList', components: { couponForm: m, couponDetailForm: y, ExportFile: k['a'] }, data: function () { return { paramDto: { page: 1, size: 10 }, couponList: [], total: 0, columns: [{ title: '优惠券编号', slot: 'ticketNumber', width: 150 }, { title: '优惠活动编号', slot: 'activityNumber' }, { title: '优惠券状态', key: 'couponState' }, { title: '优惠活动状态', key: 'activityState' }, { title: '绑定手机号', slot: 'customerPhone' }, { title: '订单号', slot: 'orderNumber' }, { title: '兑换码', key: 'redeemCode' }, { title: '有效期', key: 'validDate' }, { title: '使用条件', key: 'conditions', tooltip: !0 }, { title: '活动内容', key: 'activityContent', tooltip: !0 }], loading: !1, coupon: {}, couponLoading: !1, couponVisible: !1, visible: !1, percent: 0, interval: '' } }, methods: { listCoupon: function (t) { var e = JSON.parse(JSON.stringify(t)); this.$delete(e, 'dateRange'), this.flushData(e), Object.assign(this.paramDto, e), this.paramDto.page = 1, this.handlePageChange() }, handlePageChange: function () { var t = this; this.loading = !0, D(this.paramDto).then(function (e) { t.couponList = e.body.rows, t.total = e.body.total, t.loading = !1 }).catch(function () { t.loading = !1 }) }, flushData: function (t) { Array.isArray(t.activityState) && (t.activityState = t.activityState.join(',')), Array.isArray(t.couponState) && (t.couponState = t.couponState.join(',')) }, exportData: function (t) { if (t.batchNumber && t.activityNumber) { var e = JSON.parse(JSON.stringify(t)); this.$delete(e, 'dateRange'), this.flushData(e), this.exportFile(e) } else this.$Message.warning('导出文件时 [批次号] 和 [优惠活动编号] 是必填条件') }, openCouponDetail: function (t) { var e = this; this.coupon = {}, this.couponVisible = !0, this.couponLoading = !0, _(t.couponBid).then(function (t) { e.coupon = t.body, e.couponLoading = !1 }).catch(function () { e.couponLoading = !1 }) }, toActivityDetail: function (t) { var e = t.activityBid, a = { name: 'activityDetail', query: { activityBid: e } }; this.$router.push(a) }, exportFile: function (t) { this.percent = 0; var e = { type: 1002, jsonParam: JSON.stringify(t) }; this.$refs.exportFile.requestExportFile(e) } } }, C = x, N = (a('43e9'), Object(u['a'])(C, o, n, !1, null, '0c9397ee', null)); N.options.__file = 'couponList.vue'; e['default'] = N.exports }, 5876: function (t, e, a) {}, '788c': function (t, e, a) {}, a719: function (t, e, a) {}, bf30: function (t, e, a) { 'use strict'; var o = a('788c'), n = a.n(o); n.a }, ef05: function (t, e, a) { 'use strict'; var o = function () { var t = this, e = t.$createElement, a = t._self._c || e; return a('Modal', { attrs: { title: t.title, closable: !1, 'mask-closable': !1 }, model: { value: t.visible, callback: function (e) { t.visible = e }, expression: 'visible' } }, [a('Progress', { attrs: { percent: t.percent } }), a('div', { attrs: { slot: 'footer' }, slot: 'footer' }, [a('Button', { attrs: { type: 'text' }, on: { click: t.cancelExport } }, [t._v('取消')])], 1)], 1) }, n = [], r = a('2934'), i = { name: 'ExportFile', props: {}, data: function () { return { title: '', visible: !1, percent: 0, interval: '' } }, methods: { requestExportFile: function (t) { var e = this; this.title = '导出文件准备中...', this.percent = 0, this.visible = !0, Object(r['d'])(t).then(function (t) { e.title = '正在导出文件...', e.interval = setInterval(function () { return e.getExportProcess(t.body) }, 300) }).catch(function () { e.visible = !1 }) }, getExportProcess: function (t) { var e = this; Object(r['c'])(t).then(function (t) { t.body.finish ? (e.percent = 100, setTimeout(function () { e.visible = !1 }, 800), e.$Message.success('文件已生成，开始下载'), clearInterval(e.interval), e.download(t.body.fileUrl)) : e.percent = t.body.percent }).catch(function () { e.visible = !1, clearInterval(e.interval) }) }, download: function (t) { var e = document.createElement('a'); e.href = t, e.style = 'visibility: hidden', e.download = ''.concat(Date.now(), '.xls'), document.body.appendChild(e), e.click(), this.$forceUpdate(), setTimeout(function () { document.body.removeChild(e) }, 1e3) }, cancelExport: function () { this.$Message.info('文件导出已取消'), this.visible = !1, clearInterval(this.interval) } } }, c = i, s = (a('12a6'), a('2877')), l = Object(s['a'])(c, o, n, !1, null, 'b2d706fc', null); l.options.__file = 'ExportFile.vue'; e['a'] = l.exports } }])
