(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3cc5fb46"],{"09c3":function(t,e,a){},2043:function(t,e,a){"use strict";var r=a("2af3"),o=a.n(r);o.a},"2af3":function(t,e,a){},4958:function(t,e,a){"use strict";a.d(e,"e",function(){return o}),a.d(e,"k",function(){return n}),a.d(e,"c",function(){return i}),a.d(e,"h",function(){return s}),a.d(e,"f",function(){return u}),a.d(e,"b",function(){return l}),a.d(e,"g",function(){return c}),a.d(e,"i",function(){return p}),a.d(e,"a",function(){return d}),a.d(e,"d",function(){return m}),a.d(e,"j",function(){return h});var r=a("6b6c"),o=function(t){return r["a"].request({url:"/socialContact/getGroupsByProjectBid.action",method:"post",data:t})},n=function(t){return r["a"].request({url:"/socialContact/updateGroupByGroupId.action",method:"post",data:t})},i=function(t){return r["a"].request({url:"/socialContact/createGroup.action",method:"post",data:t})},s=function(t){return r["a"].request({url:"/socialContact/removeGroupByGroupId.action",method:"post",data:t})},u=function(t){return r["a"].request({url:"/socialContact/getMembersByGroupBid.action",method:"post",data:t})},l=function(t){return r["a"].request({url:"/socialContact/addGagMember.action",method:"post",data:t})},c=function(t){return r["a"].request({url:"/socialContact/removeGagMember.action",method:"post",data:t})},p=function(t){return r["a"].request({url:"/socialContact/removeGroupMembers.action",method:"post",data:t})},d=function(t){return r["a"].request({url:"/socialContact/addAdminMember.action",method:"post",data:t})},m=function(t){return r["a"].request({url:"/socialContact/deleteAdminMember.action",method:"post",data:t})},h=function(t){return r["a"].request({url:"/socialContact/transferGroup.action",method:"post",data:t})}},"4aba":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Form",{attrs:{model:t.paramDto,"label-width":70}},[a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{span:"8"}},[a("FormItem",{attrs:{label:"群聊名称"}},[a("Input",{attrs:{placeholder:"",clearable:""},model:{value:t.paramDto.name,callback:function(e){t.$set(t.paramDto,"name","string"===typeof e?e.trim():e)},expression:"paramDto.name"}})],1)],1),a("Col",{attrs:{span:"8"}},[a("FormItem",{attrs:{label:"操作人"}},[a("Input",{attrs:{placeholder:"系统号",clearable:""},model:{value:t.paramDto.opBid,callback:function(e){t.$set(t.paramDto,"opBid","string"===typeof e?e.trim():e)},expression:"paramDto.opBid"}})],1)],1)],1),a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{span:"12"}},[a("Button",{attrs:{type:"primary",icon:"ios-search"},on:{click:t.listGroup}},[t._v(" 查 询")])],1),a("Col",{staticStyle:{"text-align":"right"},attrs:{span:"12"}},[a("Button",{attrs:{type:"primary"},on:{click:t.addGroup}},[t._v(" 新建群聊")])],1)],1)],1),a("div",{staticClass:"full-top"},[t.loading?a("Spin",{staticClass:"full-spin",attrs:{size:"large",fix:""}}):t._e(),t._l(t.groupList,function(e,r){return a("group-card",{key:r,staticClass:"my-card",attrs:{index:r,group:e},on:{detail:t.handleDetail,update:t.updateGroup,remove:t.handleRemove}})}),t.groupList.length?t._e():a("Card",{staticClass:"my-card"},[a("div",{staticClass:"no-data"},[a("span",[t._v("没有找到匹配的记录")])])])],2),a("Page",{staticClass:"my-page",attrs:{total:t.total,"show-total":"",current:t.paramDto.page,"page-size":t.paramDto.limit},on:{"update:current":function(e){t.$set(t.paramDto,"page",e)},"on-change":t.handlePageChange}}),a("Modal",{attrs:{title:t.title,loading:t.groupLoading},on:{"on-ok":t.saveGroup},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[t.visible?a("group-form",{ref:"groupForm",attrs:{group:t.row},on:{submit:t.handleSubmit,error:t.handleError}}):t._e()],1)],1)},o=[],n=(a("7f7f"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",[a("Layout",{staticStyle:{"background-color":"#ffffff"}},[a("Sider",{staticStyle:{"background-color":"#ffffff"},attrs:{"hide-trigger":"",width:"55"}},[a("Avatar",{staticClass:"my-avatar",attrs:{src:JSON.parse(t.group.description).headUrl,shape:"square",icon:"ios-people"}})],1),a("Content",{staticStyle:{"margin-left":"20px"}},[a("span",{staticClass:"my-name"},[t._v(t._s(t.group.name))]),a("Row",{style:{marginTop:"5px"},attrs:{gutter:10}},[a("Col",{attrs:{span:6}},[a("span",{staticClass:"my-content"},[t._v("创建于: "+t._s(t._f("dateTimeFilter")(t.group.createDate)))])]),a("Col",{attrs:{span:6}},[a("span",{staticClass:"my-content"},[t._v("人数限制: "+t._s(t.group.maxusers)+" 人")])]),a("Col",{attrs:{span:6}},[a("span",{staticClass:"my-content"},[t._v("创建人: "+t._s(t.group.opBid))])]),a("Col",{staticStyle:{"text-align":"right"},attrs:{span:6}},[a("a",{staticClass:"my-btn",on:{click:t.toDetail}},[a("Icon",{attrs:{type:"md-arrow-dropright"}}),t._v("\n            成员\n          ")],1),a("a",{staticClass:"my-btn",on:{click:t.toUpdate}},[a("Icon",{attrs:{type:"md-settings"}}),t._v("\n            设置\n          ")],1),a("a",{style:{color:"#ed4014"},on:{click:t.remove}},[t._v("解散")])])],1)],1)],1)],1)}),i=[],s=(a("c5f6"),{name:"groupCard",props:{group:Object,index:Number},data:function(){return{}},methods:{toDetail:function(){this.$emit("detail",this.index)},toUpdate:function(){this.$emit("update",this.index)},remove:function(){this.$emit("remove",this.index)}}}),u=s,l=(a("adc7e"),a("2877")),c=Object(l["a"])(u,n,i,!1,null,"41942ecb",null);c.options.__file="groupCard.vue";var p=c.exports,d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Form",{ref:"groupForm",attrs:{model:t.paramDto,rules:t.groupRules,"label-width":100}},[a("FormItem",{attrs:{label:"群聊名称",prop:"groupname"}},[a("Input",{attrs:{placeholder:"",clearable:""},model:{value:t.paramDto.groupname,callback:function(e){t.$set(t.paramDto,"groupname","string"===typeof e?e.trim():e)},expression:"paramDto.groupname"}})],1),t.paramDto.groupId?t._e():a("FormItem",{attrs:{label:"管理员手机号",prop:"mobile"}},[a("Input",{attrs:{placeholder:"",clearable:""},model:{value:t.paramDto.mobile,callback:function(e){t.$set(t.paramDto,"mobile","string"===typeof e?e.trim():e)},expression:"paramDto.mobile"}})],1),a("FormItem",{attrs:{label:"群头像",prop:"headUrl"}},[a("Input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{placeholder:"",clearable:""},model:{value:t.paramDto.headUrl,callback:function(e){t.$set(t.paramDto,"headUrl",e)},expression:"paramDto.headUrl"}}),t._l(t.uploadList,function(e,r){return a("div",{key:r,staticClass:"demo-upload-list"},["finished"===e.status?[a("img",{attrs:{src:e.response?e.response.body.attachmentImgUrl:e.url}}),a("div",{staticClass:"demo-upload-list-cover"},[a("Icon",{attrs:{type:"ios-trash-outline"},nativeOn:{click:function(a){t.handleRemove(e)}}})],1)]:[e.showProgress?a("Progress",{attrs:{percent:e.percentage,"hide-info":""}}):t._e()]],2)}),t.uploadList.length?t._e():a("Upload",{ref:"upload",staticStyle:{display:"inline-block",width:"46px"},attrs:{accept:"image/*",type:"drag",headers:{Authorization:t.$store.state.user.token},action:t.uploadPicUrl,"show-upload-list":!1,"on-success":t.handleSuccess,"on-error":t.handleError,"max-size":200,"on-exceeded-size":t.handleMaxSize}},[a("div",{staticStyle:{width:"46px","line-height":"46px"}},[a("Icon",{attrs:{type:"ios-camera",size:"20"}})],1)]),t.uploadList.length?t._e():a("div",[t._v("图片大小不能超过 200KB")])],2)],1)},m=[],h=(a("ac6a"),a("456d"),{name:"groupForm",props:{group:Object},data:function(){return{paramDto:{groupId:"",groupname:"",mobile:"",headUrl:""},groupRules:{groupname:[{required:!0,message:"请输入群聊名称",trigger:"blur"},{max:50,type:"string",message:"长度在200个字符以内",trigger:"blur"}],mobile:[{required:!0,message:"请输入管理员手机号",trigger:"blur"},{pattern:/^1\d{10}$/,message:"手机号格式有误",trigger:"blur"}],headUrl:[{required:!0,message:"请上传头像图片",trigger:"blur"}]},uploadPicUrl:this.$store.state.app.baseUrl+"/system/upLoadImg.action",uploadList:[]}},methods:{validForm:function(){var t=this;this.$refs["groupForm"].validate(function(e){e?t.$emit("submit",t.paramDto):t.$emit("error")})},handleMaxSize:function(t){this.$Message.warning("文件大小超过了限制")},handleSuccess:function(t,e,a){200!==t.code?this.$Message.error(t.message):(this.paramDto.headUrl=t.body.attachmentImgUrl,this.uploadList=this.$refs.upload.fileList)},handleError:function(t,e,a){this.$Message.error("图片上传失败"),console.info(t)},handleRemove:function(t){if(this.$refs.upload){var e=this.$refs.upload.fileList;this.$refs.upload.fileList.splice(e.indexOf(t),1)}else this.uploadList.splice(0,1);this.paramDto.headUrl=""}},created:function(){Object.keys(this.group).length&&(this.paramDto.groupId=this.group.groupId,this.paramDto.groupname=this.group.name,this.paramDto.headUrl=JSON.parse(this.group.description).headUrl,this.uploadList.push({url:this.paramDto.headUrl,status:"finished"}))}}),g=h,f=(a("a06d"),Object(l["a"])(g,d,m,!1,null,"6944645a",null));f.options.__file="groupForm.vue";var v=f.exports,b=a("4958"),y={name:"groupList",components:{groupCard:p,groupForm:v},data:function(){return{paramDto:{name:"",opBid:"",page:1,limit:5},loading:!1,groupList:[],total:0,visible:!1,groupLoading:!0,title:"",row:{}}},methods:{listGroup:function(){this.paramDto.page=1,this.handlePageChange()},handlePageChange:function(){var t=this;this.loading=!0,Object(b["e"])(this.paramDto).then(function(e){t.groupList=e.body.rows,t.total=e.body.total,t.loading=!1}).catch(function(){t.loading=!1})},addGroup:function(){this.visible=!0,this.title="新建群聊",this.row={}},updateGroup:function(t){this.visible=!0,this.title="修改群聊",this.row=this.groupList[t]},handleDetail:function(t){var e=this.groupList[t].groupId,a=this.groupList[t].name,r={name:"chatMemberList",query:{groupId:e,groupName:a}};this.$router.push(r)},handleRemove:function(t){var e=this;this.$Modal.confirm({title:"通知",content:"<p>确定解散该群聊吗，本操作无法回滚？</p>",onOk:function(){e.removeGroup(t)},onCancel:function(){}})},removeGroup:function(t){var e=this,a={groupId:this.groupList[t].groupId,owner:this.groupList[t].owner};Object(b["h"])(a).then(function(t){e.$Message.success("解散群聊成功"),e.visible=!1,e.listGroup()})},saveGroup:function(){this.$refs.groupForm.validForm()},handleSubmit:function(t){t.groupId?this.handleUpdateGroup(t):this.handleSaveGroup(t)},handleUpdateGroup:function(t){var e=this,a={groupId:t.groupId,groupname:t.groupname,description:JSON.stringify({headUrl:t.headUrl})};Object(b["k"])(a).then(function(t){e.$Message.success("更新群聊成功"),e.visible=!1,e.listGroup()}).catch(function(){e.handleError()})},handleSaveGroup:function(t){var e=this,a={groupname:t.groupname,mobile:t.mobile,desc:JSON.stringify({headUrl:t.headUrl})};Object(b["c"])(a).then(function(t){e.$Message.success("创建群聊成功"),e.visible=!1,e.listGroup()}).catch(function(){e.handleError()})},handleError:function(){var t=this;setTimeout(function(){t.groupLoading=!1,t.$nextTick(function(){t.groupLoading=!0})},500)}},created:function(){this.listGroup()}},C=y,D=(a("2043"),Object(l["a"])(C,r,o,!1,null,"76aa4590",null));D.options.__file="groupList.vue";e["default"]=D.exports},5221:function(t,e,a){},a06d:function(t,e,a){"use strict";var r=a("5221"),o=a.n(r);o.a},adc7e:function(t,e,a){"use strict";var r=a("09c3"),o=a.n(r);o.a}}]);