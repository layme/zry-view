(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f2f990ae"],{1798:function(e,t,i){"use strict";var r=i("b1da"),a=i.n(r);a.a},"23d2":function(e,t,i){"use strict";var r=i("bb69"),a=i.n(r);a.a},"253c":function(e,t,i){},2763:function(e,t,i){"use strict";var r=i("9c63"),a=i.n(r);a.a},"2d1b":function(e,t,i){"use strict";var r=i("253c"),a=i.n(r);a.a},"46c5":function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("Form",{attrs:{model:e.priceDto,"label-width":50,inline:""}},[i("FormItem",{attrs:{label:"营业日"}},[i("DatePicker",{staticClass:"my-date-picker",attrs:{type:"daterange","split-panels":"",placeholder:"",clearable:!1,editable:!1},on:{"on-change":e.handleDateRange},model:{value:e.priceDto.priceDate,callback:function(t){e.$set(e.priceDto,"priceDate",t)},expression:"priceDto.priceDate"}})],1),i("FormItem",[i("Button",{attrs:{type:"primary",icon:"ios-search"},on:{click:function(t){e.getPriceList()}}},[e._v(" 查 询")])],1),i("FormItem",[i("Button",{attrs:{type:"primary"},on:{click:e.openChangePriceDialog}},[e._v("房价调整")])],1),i("Row",[i("FormItem",{attrs:{label:"筛选"}},[i("CheckboxGroup",{model:{value:e.checkedPriceType,callback:function(t){e.checkedPriceType=t},expression:"checkedPriceType"}},e._l(e.$store.state.price.priceTypeList,function(t){return 0===t.isHideHousePrice?i("Checkbox",{key:t.code,attrs:{label:t.code}},[e._v(e._s(t.name))]):e._e()}))],1)],1)],1),i("div",{staticClass:"full-top"},[e.loadingTable?i("Spin",{staticClass:"full-spin",attrs:{size:"large",fix:""}}):e._e(),e._l(e.priceList,function(t,r,a){return i("price-card",{key:a,staticClass:"my-card",attrs:{date:r,"price-list":t,"checked-price-type":e.checkedPriceType}})}),Object.keys(e.priceList).length?e._e():i("Card",{staticClass:"my-card"},[i("div",{staticClass:"no-data"},[i("span",[e._v("没有找到匹配的记录")])])])],2),i("Modal",{attrs:{title:"房价调整",width:1300,"footer-hide":""},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[e.modalVisible?i("price-edit",{on:{success:function(t){e.modalVisible=!1}}}):e._e()],1)],1)},a=[],c=(i("ac6a"),i("be94")),n=(i("cadf"),i("551c"),i("097d"),i("b88a")),s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Card",[i("p",{attrs:{slot:"title"},slot:"title"},[e._v("\n    "+e._s(e.date)+"\n  ")]),i("Table",{attrs:{stripe:"",size:"small",columns:e.getColumn,data:e.priceList}})],1)},o=[],p=(i("7f7f"),i("7514"),{name:"priceCard",props:{date:String,priceList:Array,checkedPriceType:Array},data:function(){return{columns:[]}},computed:{getColumn:function(){var e=this,t=[{title:"房型",key:"houseName",fixed:"left",width:200}];return this.$store.state.price.priceTypeList.forEach(function(i){e.checkedPriceType.find(function(e){return e===i.code})&&t.push({title:"".concat(i.name,"/元"),key:i.code,align:"center",minWidth:200})}),t}},methods:{}}),d=p,l=(i("2d1b"),i("2877")),u=Object(l["a"])(d,s,o,!1,null,"76001720",null);u.options.__file="priceCard.vue";var h=u.exports,f=i("2f62"),m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("Steps",{staticStyle:{"margin-bottom":"20px"},attrs:{current:e.current}},[i("Step",{attrs:{title:"基础信息"}}),i("Step",{attrs:{title:"设置价格"}})],1),i("price-info-form",{directives:[{name:"show",rawName:"v-show",value:0===e.current,expression:"current === 0"}],ref:"infoRef",on:{next:e.nextStep}}),1===e.current?i("price-edit-table",{ref:"priceTableRef",attrs:{"price-info":e.priceSaveDto},on:{submit:e.savePrice}}):e._e(),i("div",{staticStyle:{"text-align":"right"}},[0===e.current?i("Button",{attrs:{type:"primary",ghost:""},on:{click:e.validInfo}},[e._v("下一步 "),i("Icon",{attrs:{type:"ios-arrow-forward"}})],1):e._e(),1===e.current?i("Button",{staticStyle:{"margin-right":"20px"},attrs:{type:"primary",ghost:""},on:{click:function(t){e.current=0}}},[i("Icon",{attrs:{type:"ios-arrow-back"}}),e._v(" 上一步")],1):e._e(),1===e.current?i("Button",{attrs:{type:"primary"},on:{click:e.createPrice}},[e._v("生成房价")]):e._e()],1)],1)},y=[],b=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Form",{ref:"priceInfoForm",staticClass:"my-form",attrs:{model:e.priceSaveDto,rules:e.rules,"label-width":80}},[i("FormItem",{attrs:{label:"房价类型",prop:"addCheckedPriceTypeList"}},[i("CheckboxGroup",{on:{"on-change":e.handleChange},model:{value:e.priceSaveDto.addCheckedPriceTypeList,callback:function(t){e.$set(e.priceSaveDto,"addCheckedPriceTypeList",t)},expression:"priceSaveDto.addCheckedPriceTypeList"}},[e._l(e.priceTypeList,function(t){return 0===t.isBindCounterPrice&&0===t.isHideHousePrice?i("Checkbox",{key:t.code,attrs:{label:t.code}},[e._v(e._s(t.name)+"\n      ")]):e._e()}),e.showInput?i("Input",{ref:"inputRef",staticStyle:{width:"200px"},attrs:{size:"small",placeholder:"输入隐藏房价码, 回车确认"},on:{"on-enter":e.handleHidePriceTypeCodeChange,"on-blur":e.handleBlur},model:{value:e.hidePriceTypeCode,callback:function(t){e.hidePriceTypeCode=t},expression:"hidePriceTypeCode"}}):i("a",{on:{click:e.handleShowInput}},[i("Icon",{attrs:{type:"ios-add-circle-outline"}}),e._v(" 添加隐藏房价类型")],1)],2)],1),i("FormItem",{attrs:{label:"房型",prop:"addHouseTypeList"}},[i("CheckboxGroup",{on:{"on-change":e.handleChange},model:{value:e.priceSaveDto.addHouseTypeList,callback:function(t){e.$set(e.priceSaveDto,"addHouseTypeList",t)},expression:"priceSaveDto.addHouseTypeList"}},e._l(e.$store.state.price.currentHouseTypeList,function(t){return i("Checkbox",{key:t.bid,attrs:{label:t.bid}},[e._v("\n        "+e._s(t.houseTypeParentName+t.houseName)+"\n      ")])}))],1),i("FormItem",{attrs:{label:"日期",prop:"priceDate"}},[i("DatePicker",{staticStyle:{width:"500px"},attrs:{type:"daterange","split-panels":"",placeholder:e.datePlaceholder,clearable:"",editable:!1,disabled:!(e.priceSaveDto.addCheckedPriceTypeList.length&&e.priceSaveDto.addHouseTypeList.length),options:e.dateOptions},on:{"on-change":e.handleDateChange},model:{value:e.priceSaveDto.priceDate,callback:function(t){e.$set(e.priceSaveDto,"priceDate",t)},expression:"priceSaveDto.priceDate"}})],1),i("FormItem",{attrs:{label:"特殊星期",prop:"specialWeekList"}},[i("CheckboxGroup",{model:{value:e.priceSaveDto.specialWeekList,callback:function(t){e.$set(e.priceSaveDto,"specialWeekList",t)},expression:"priceSaveDto.specialWeekList"}},e._l(e.$store.state.price.weekOptions,function(t){return i("Checkbox",{key:t.value,attrs:{label:t.value}},[e._v("\n        "+e._s(t.label)+"\n      ")])}))],1),i("FormItem",{attrs:{label:"调价原因",prop:"adjustCode"}},[i("Select",{staticStyle:{width:"500px"},attrs:{placeholder:"",clearable:""},model:{value:e.priceSaveDto.adjustCode,callback:function(t){e.$set(e.priceSaveDto,"adjustCode",t)},expression:"priceSaveDto.adjustCode"}},e._l(e.$store.state.price.adjustType,function(e,t,r){return i("Option",{key:r,attrs:{label:e,value:t}})}))],1),i("FormItem",{attrs:{label:"调价说明",prop:"description"}},[i("Input",{staticStyle:{width:"80%"},attrs:{type:"textarea",placeholder:"",row:4,maxlength:200},model:{value:e.priceSaveDto.description,callback:function(t){e.$set(e.priceSaveDto,"description","string"===typeof t?t.trim():t)},expression:"priceSaveDto.description"}})],1)],1)},D=[],g=(i("a481"),i("90de")),k={name:"priceInfoForm",data:function(){return{priceSaveDto:{channelCodes:"",houseTypeFids:"",specialWeeks:"",startDate:"",endDate:"",priceChangeDetailDtoList:[],adjustCode:"",description:"",priceDate:[],specialWeekList:[],addCheckedPriceTypeList:[],addHouseTypeList:[]},rules:{addCheckedPriceTypeList:[{type:"array",required:!0,message:"请选择房价类型",trigger:"change"}],addHouseTypeList:[{type:"array",required:!0,message:"请选择房型",trigger:"change"}],priceDate:[{required:!0,type:"array",fields:{0:{type:"date",required:!0,message:"请选择日期"},1:{type:"date",required:!0,message:"请选择日期"}},trigger:"change"}],adjustCode:[{required:!0,message:"请选择调价原因",trigger:"change"}],description:[{required:!0,message:"请填写调价说明",trigger:"blur"}]},priceTypeList:JSON.parse(JSON.stringify(this.$store.state.price.priceTypeList)),hidePriceTypeCode:"",showInput:!1,maxDate:Date.now(),dateOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}}}},computed:{datePlaceholder:function(){return"开始日期不能大于 ".concat(Object(g["f"])(this.maxDate,"date"))}},methods:{handleHidePriceTypeCodeChange:function(){var e=this;this.hidePriceTypeCode=this.hidePriceTypeCode.replace(/([\u4e00-\u9fa5])|(\s)|[^\d\w]/g,""),this.hidePriceTypeCode.length&&Object(n["a"])({typeCode:this.hidePriceTypeCode}).then(function(t){var i=t.body;if(1!==i.isBindCounterPrice){var r,a=-1;e.priceTypeList.forEach(function(e,t){e.code===i.code&&(a=t,r=e)}),a?1===r.isHideHousePrice?(e.priceTypeList[a].isHideHousePrice=0,e.priceSaveDto.addCheckedPriceTypeList.push(i.code),e.handleBlur()):e.$Message.warning("该隐藏码已显示"):(e.$Message.success("房价码 ".concat(v.name," 添加成功，请选择")),e.priceTypeList.push(i),e.priceSaveDto.addCheckedPriceTypeList.push(i.code))}else e.$Message.warning("该隐藏房价类型已绑定门市价，修改门市价即可")})},handleChange:function(){this.priceSaveDto.priceDate=[],this.priceSaveDto.addCheckedPriceTypeList.length&&this.priceSaveDto.addHouseTypeList.length&&this.getPriceMinDate()},getPriceMinDate:function(){var e=this;Object(n["b"])({houseTypeFidList:this.priceSaveDto.addHouseTypeList,channelCodeList:this.priceSaveDto.addCheckedPriceTypeList}).then(function(t){var i=t.body+864e5,r=Date.now();e.maxDate=i>=r?i:r})},handleDateChange:function(e){-1===Object(g["a"])(e[0],Object(g["f"])(this.maxDate,"date"))&&(this.$Message.warning("开始日期不能大于 ".concat(Object(g["f"])(this.maxDate,"date"))),this.priceSaveDto.priceDate=[])},validateForm:function(){var e=this;this.$refs.priceInfoForm.validate(function(t){if(!t)return!1;e.$emit("next",e.priceSaveDto)})},handleShowInput:function(){var e=this;this.showInput=!0,this.$nextTick(function(){e.$refs.inputRef.$refs.input.focus()})},handleBlur:function(){this.showInput=!1,this.hidePriceTypeCode=""}},filters:{ellipsis:function(e){if(!e)return"";for(var t=e,i=0,r=0;r<e.length;r++)if(/[\u4e00-\u9fa5]/.test(e[r])?i+=2:i++,i>16){t=e.slice(0,r)+"..";break}return t}}},T=k,C=(i("1798"),Object(l["a"])(T,b,D,!1,null,"5b3acf06",null));C.options.__file="priceInfoForm.vue";var P=C.exports,L=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Table",{staticClass:"my-table",attrs:{columns:e.columns,data:e.detail,border:""}})},S=[],_=(i("456d"),{name:"priceEditTable",props:{priceInfo:Object},data:function(){return{priceDto:{specialWeekList:[],addCheckedPriceTypeList:[],addHouseTypeList:[]},detail:[]}},computed:{columns:function(){var e=this,t=[{title:"房价类型",key:"name",align:"center",width:120,fixed:"left"}];return this.priceDto.addHouseTypeList.forEach(function(i){var r=e.$store.state.price.currentHouseTypeList.find(function(e){return e.bid===i}),a=e,c={title:r.houseTypeParentName+r.houseName,align:"center",children:[{title:"平日",align:"center",minWidth:120,render:function(e,t){return e("InputNumber",{props:{value:t.row["".concat(r.bid,"-normalPrice")],min:1,max:1e4},style:{width:"100%"},on:{input:function(e){a.detail[t.index]["".concat(r.bid,"-normalPrice")]=e}}})}}]};e.priceDto.specialWeekList.length&&c.children.push({title:"周末",align:"center",minWidth:120,render:function(e,t){return e("InputNumber",{props:{value:t.row["".concat(r.bid,"-specialWeekPrice")],min:1,max:1e4},style:{width:"100%"},on:{input:function(e){a.detail[t.index]["".concat(r.bid,"-specialWeekPrice")]=e}}})}}),t.push(c)}),t}},methods:{buildPriceDetail:function(){var e=this;this.priceDto.addCheckedPriceTypeList.forEach(function(t){var i=e.$store.state.price.priceTypeList.find(function(e){return e.code===t}),r={code:i.code,name:i.name};e.priceDto.addHouseTypeList.forEach(function(t){r["".concat(t,"-normalPrice")]=null,e.priceDto.specialWeekList.length&&(r["".concat(t,"-specialWeekPrice")]=null)}),e.detail.push(r)})},valid:function(){var e=this,t=!1;this.detail.some(function(i){return Object.keys(i).some(function(r){if("code"!==r&&"name"!==r&&!i[r])return e.$Message.warning("请输入价格，不能留有空的"),t=!0,t}),t}),t||this.createPrice()},createPrice:function(){var e=this;this.priceDto.priceChangeDetailDtoList=[],this.detail.forEach(function(t){e.priceDto.addHouseTypeList.forEach(function(i){var r={channelCode:t.code,houseTypeFid:"",normalPrice:"",specialWeekPrice:""};r.houseTypeFid=i,r.normalPrice=100*t["".concat(i,"-normalPrice")],e.priceDto.specialWeekList.length&&(r.specialWeekPrice=100*t["".concat(i,"-specialWeekPrice")]),e.priceDto.priceChangeDetailDtoList.push(r)})}),this.$emit("submit",this.priceDto)}},created:function(){this.priceDto=this.priceInfo,this.buildPriceDetail()}}),x=_,w=(i("2763"),Object(l["a"])(x,L,S,!1,null,"53fd2a53",null));w.options.__file="priceEditTable.vue";var $=w.exports,j={name:"priceEdit",components:{priceInfoForm:P,priceEditTable:$},data:function(){return{current:0,priceSaveDto:{}}},methods:{validInfo:function(){this.$refs.infoRef.validateForm()},nextStep:function(e){this.current=1,this.priceSaveDto=e},createPrice:function(){this.$refs.priceTableRef.valid()},savePrice:function(e){var t=this;e.channelCodes=e.addCheckedPriceTypeList.join(","),e.houseTypeFids=e.addHouseTypeList.join(","),e.specialWeeks=e.specialWeekList.join(","),e.startDate=Object(g["f"])(e.priceDate[0],"date"),e.endDate=Object(g["f"])(e.priceDate[1],"date"),Object(n["f"])(e).then(function(){t.$Message.success("价格保存成功"),t.$emit("success")})}}},I=j,H=(i("23d2"),Object(l["a"])(I,m,y,!1,null,"7920f588",null));H.options.__file="priceEdit.vue";var O=H.exports,F={name:"priceList",components:{priceCard:h,priceEdit:O},data:function(){return{priceDto:{priceDate:[new Date,new Date],channelCodeList:[]},checkedPriceType:[],priceList:[],modalVisible:!1,loadingTable:!1}},methods:Object(c["a"])({},Object(f["b"])(["getCurrentHouseType","getPriceTypeList","getAdjustTypeList"]),{handleDateRange:function(e){Object(g["d"])(e[0],e[1])>30&&(this.$Message.warning("最多查询30天的价格"),this.priceDto.priceDate=[new Date,new Date])},openChangePriceDialog:function(){this.modalVisible=!0},getPriceList:function(){var e=this;this.loadingTable=!0,Object(n["d"])(this.priceDto).then(function(t){e.priceList=t.body,e.loadingTable=!1}).catch(function(){e.loadingTable=!1})}}),created:function(){var e=this;this.getPriceTypeList().then(function(t){t.body.forEach(function(t){0===t.isHideHousePrice&&(e.priceDto.channelCodeList.push(t.code),e.checkedPriceType.length<3&&e.checkedPriceType.push(t.code))}),e.getPriceList()}),this.getAdjustTypeList(),this.getCurrentHouseType()},filters:{ellipsis:function(e){if(!e)return"";for(var t=e,i=0,r=0;r<e.length;r++)if(/[\u4e00-\u9fa5]/.test(e[r])?i+=2:i++,i>16){t=e.slice(0,r)+"..";break}return t}}},W=F,E=(i("982f"),Object(l["a"])(W,r,a,!1,null,"74e27136",null));E.options.__file="priceList.vue";t["default"]=E.exports},"6d65":function(e,t,i){},"982f":function(e,t,i){"use strict";var r=i("6d65"),a=i.n(r);a.a},"9c63":function(e,t,i){},b1da:function(e,t,i){},bb69:function(e,t,i){}}]);